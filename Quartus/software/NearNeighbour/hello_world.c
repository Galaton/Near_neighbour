#include <stdio.h>
#include <stdint.h>

// Defining inputs
#define ack (volatile char *) 0x21060
#define INTERRUPT (volatile char *) 0x21070
#define RESULT (volatile char *) 0x21080

// Defining outputs
#define DATA_BASE (volatile char *) 0x21040
#define REQUEST (volatile char *) 0x21050

#define QUANTIDADE_DE_DADOS 400

uint8_t matriz[QUANTIDADE_DE_DADOS][5] = {{10,10,0,0,0},{10,40,0,0,0},{40,40,0,0,0},{40,10,0,0,0},{10,10,0,0,0},{10,41,0,0,0},{41,41,0,0,0},{41,10,0,0,0},{10,10,0,0,0},{10,42,0,0,0},{42,42,0,0,0},{42,10,0,0,0},{10,10,0,0,0},{10,43,0,0,0},{43,43,0,0,0},{43,10,0,0,0},{10,10,0,0,0},{10,44,0,0,0},{44,44,0,0,0},{44,10,0,0,0},{10,10,0,0,0},{10,45,0,0,0},{45,45,0,0,0},{45,10,0,0,0},{10,10,0,0,0},{10,46,0,0,0},{46,46,0,0,0},{46,10,0,0,0},{10,10,0,0,0},{10,47,0,0,0},{47,47,0,0,0},{47,10,0,0,0},{10,10,0,0,0},{10,48,0,0,0},{48,48,0,0,0},{48,10,0,0,0},{10,10,0,0,0},{10,49,0,0,0},{49,49,0,0,0},{49,10,0,0,0},{11,11,0,0,0},{11,40,0,0,0},{40,40,0,0,0},{40,11,0,0,0},{11,11,0,0,0},{11,41,0,0,0},{41,41,0,0,0},{41,11,0,0,0},{11,11,0,0,0},{11,42,0,0,0},{42,42,0,0,0},{42,11,0,0,0},{11,11,0,0,0},{11,43,0,0,0},{43,43,0,0,0},{43,11,0,0,0},{11,11,0,0,0},{11,44,0,0,0},{44,44,0,0,0},{44,11,0,0,0},{11,11,0,0,0},{11,45,0,0,0},{45,45,0,0,0},{45,11,0,0,0},{11,11,0,0,0},{11,46,0,0,0},{46,46,0,0,0},{46,11,0,0,0},{11,11,0,0,0},{11,47,0,0,0},{47,47,0,0,0},{47,11,0,0,0},{11,11,0,0,0},{11,48,0,0,0},{48,48,0,0,0},{48,11,0,0,0},{11,11,0,0,0},{11,49,0,0,0},{49,49,0,0,0},{49,11,0,0,0},{12,12,0,0,0},{12,40,0,0,0},{40,40,0,0,0},{40,12,0,0,0},{12,12,0,0,0},{12,41,0,0,0},{41,41,0,0,0},{41,12,0,0,0},{12,12,0,0,0},{12,42,0,0,0},{42,42,0,0,0},{42,12,0,0,0},{12,12,0,0,0},{12,43,0,0,0},{43,43,0,0,0},{43,12,0,0,0},{12,12,0,0,0},{12,44,0,0,0},{44,44,0,0,0},{44,12,0,0,0},{12,12,0,0,0},{12,45,0,0,0},{45,45,0,0,0},{45,12,0,0,0},{12,12,0,0,0},{12,46,0,0,0},{46,46,0,0,0},{46,12,0,0,0},{12,12,0,0,0},{12,47,0,0,0},{47,47,0,0,0},{47,12,0,0,0},{12,12,0,0,0},{12,48,0,0,0},{48,48,0,0,0},{48,12,0,0,0},{12,12,0,0,0},{12,49,0,0,0},{49,49,0,0,0},{49,12,0,0,0},{13,13,0,0,0},{13,40,0,0,0},{40,40,0,0,0},{40,13,0,0,0},{13,13,0,0,0},{13,41,0,0,0},{41,41,0,0,0},{41,13,0,0,0},{13,13,0,0,0},{13,42,0,0,0},{42,42,0,0,0},{42,13,0,0,0},{13,13,0,0,0},{13,43,0,0,0},{43,43,0,0,0},{43,13,0,0,0},{13,13,0,0,0},{13,44,0,0,0},{44,44,0,0,0},{44,13,0,0,0},{13,13,0,0,0},{13,45,0,0,0},{45,45,0,0,0},{45,13,0,0,0},{13,13,0,0,0},{13,46,0,0,0},{46,46,0,0,0},{46,13,0,0,0},{13,13,0,0,0},{13,47,0,0,0},{47,47,0,0,0},{47,13,0,0,0},{13,13,0,0,0},{13,48,0,0,0},{48,48,0,0,0},{48,13,0,0,0},{13,13,0,0,0},{13,49,0,0,0},{49,49,0,0,0},{49,13,0,0,0},{14,14,0,0,0},{14,40,0,0,0},{40,40,0,0,0},{40,14,0,0,0},{14,14,0,0,0},{14,41,0,0,0},{41,41,0,0,0},{41,14,0,0,0},{14,14,0,0,0},{14,42,0,0,0},{42,42,0,0,0},{42,14,0,0,0},{14,14,0,0,0},{14,43,0,0,0},{43,43,0,0,0},{43,14,0,0,0},{14,14,0,0,0},{14,44,0,0,0},{44,44,0,0,0},{44,14,0,0,0},{14,14,0,0,0},{14,45,0,0,0},{45,45,0,0,0},{45,14,0,0,0},{14,14,0,0,0},{14,46,0,0,0},{46,46,0,0,0},{46,14,0,0,0},{14,14,0,0,0},{14,47,0,0,0},{47,47,0,0,0},{47,14,0,0,0},{14,14,0,0,0},{14,48,0,0,0},{48,48,0,0,0},{48,14,0,0,0},{14,14,0,0,0},{14,49,0,0,0},{49,49,0,0,0},{49,14,0,0,0},{15,15,0,0,0},{15,40,0,0,0},{40,40,0,0,0},{40,15,0,0,0},{15,15,0,0,0},{15,41,0,0,0},{41,41,0,0,0},{41,15,0,0,0},{15,15,0,0,0},{15,42,0,0,0},{42,42,0,0,0},{42,15,0,0,0},{15,15,0,0,0},{15,43,0,0,0},{43,43,0,0,0},{43,15,0,0,0},{15,15,0,0,0},{15,44,0,0,0},{44,44,0,0,0},{44,15,0,0,0},{15,15,0,0,0},{15,45,0,0,0},{45,45,0,0,0},{45,15,0,0,0},{15,15,0,0,0},{15,46,0,0,0},{46,46,0,0,0},{46,15,0,0,0},{15,15,0,0,0},{15,47,0,0,0},{47,47,0,0,0},{47,15,0,0,0},{15,15,0,0,0},{15,48,0,0,0},{48,48,0,0,0},{48,15,0,0,0},{15,15,0,0,0},{15,49,0,0,0},{49,49,0,0,0},{49,15,0,0,0},{16,16,0,0,0},{16,40,0,0,0},{40,40,0,0,0},{40,16,0,0,0},{16,16,0,0,0},{16,41,0,0,0},{41,41,0,0,0},{41,16,0,0,0},{16,16,0,0,0},{16,42,0,0,0},{42,42,0,0,0},{42,16,0,0,0},{16,16,0,0,0},{16,43,0,0,0},{43,43,0,0,0},{43,16,0,0,0},{16,16,0,0,0},{16,44,0,0,0},{44,44,0,0,0},{44,16,0,0,0},{16,16,0,0,0},{16,45,0,0,0},{45,45,0,0,0},{45,16,0,0,0},{16,16,0,0,0},{16,46,0,0,0},{46,46,0,0,0},{46,16,0,0,0},{16,16,0,0,0},{16,47,0,0,0},{47,47,0,0,0},{47,16,0,0,0},{16,16,0,0,0},{16,48,0,0,0},{48,48,0,0,0},{48,16,0,0,0},{16,16,0,0,0},{16,49,0,0,0},{49,49,0,0,0},{49,16,0,0,0},{17,17,0,0,0},{17,40,0,0,0},{40,40,0,0,0},{40,17,0,0,0},{17,17,0,0,0},{17,41,0,0,0},{41,41,0,0,0},{41,17,0,0,0},{17,17,0,0,0},{17,42,0,0,0},{42,42,0,0,0},{42,17,0,0,0},{17,17,0,0,0},{17,43,0,0,0},{43,43,0,0,0},{43,17,0,0,0},{17,17,0,0,0},{17,44,0,0,0},{44,44,0,0,0},{44,17,0,0,0},{17,17,0,0,0},{17,45,0,0,0},{45,45,0,0,0},{45,17,0,0,0},{17,17,0,0,0},{17,46,0,0,0},{46,46,0,0,0},{46,17,0,0,0},{17,17,0,0,0},{17,47,0,0,0},{47,47,0,0,0},{47,17,0,0,0},{17,17,0,0,0},{17,48,0,0,0},{48,48,0,0,0},{48,17,0,0,0},{17,17,0,0,0},{17,49,0,0,0},{49,49,0,0,0},{49,17,0,0,0},{18,18,0,0,0},{18,40,0,0,0},{40,40,0,0,0},{40,18,0,0,0},{18,18,0,0,0},{18,41,0,0,0},{41,41,0,0,0},{41,18,0,0,0},{18,18,0,0,0},{18,42,0,0,0},{42,42,0,0,0},{42,18,0,0,0},{18,18,0,0,0},{18,43,0,0,0},{43,43,0,0,0},{43,18,0,0,0},{18,18,0,0,0},{18,44,0,0,0},{44,44,0,0,0},{44,18,0,0,0},{18,18,0,0,0},{18,45,0,0,0},{45,45,0,0,0},{45,18,0,0,0},{18,18,0,0,0},{18,46,0,0,0},{46,46,0,0,0},{46,18,0,0,0},{18,18,0,0,0},{18,47,0,0,0},{47,47,0,0,0},{47,18,0,0,0},{18,18,0,0,0},{18,48,0,0,0},{48,48,0,0,0},{48,18,0,0,0},{18,18,0,0,0},{18,49,0,0,0},{49,49,0,0,0},{49,18,0,0,0},{19,19,0,0,0},{19,40,0,0,0},{40,40,0,0,0},{40,19,0,0,0},{19,19,0,0,0},{19,41,0,0,0},{41,41,0,0,0},{41,19,0,0,0},{19,19,0,0,0},{19,42,0,0,0},{42,42,0,0,0},{42,19,0,0,0},{19,19,0,0,0},{19,43,0,0,0},{43,43,0,0,0},{43,19,0,0,0},{19,19,0,0,0},{19,44,0,0,0},{44,44,0,0,0},{44,19,0,0,0},{19,19,0,0,0},{19,45,0,0,0},{45,45,0,0,0},{45,19,0,0,0},{19,19,0,0,0},{19,46,0,0,0},{46,46,0,0,0},{46,19,0,0,0},{19,19,0,0,0},{19,47,0,0,0},{47,47,0,0,0},{47,19,0,0,0},{19,19,0,0,0},{19,48,0,0,0},{48,48,0,0,0},{48,19,0,0,0},{19,19,0,0,0},{19,49,0,0,0},{49,49,0,0,0},{49,19,0,0,0}};

int quantos_vizinhos(uint8_t raio, uint8_t dado, uint8_t minVizinhos){

  int i;
  uint8_t vector_aux[4];

  // inicia dados
  vector_aux[0] = matriz[dado][1];
  vector_aux[1] = matriz[dado][0];
  vector_aux[2] = 0;
  vector_aux[3] = 0;

  // inicia o acelerador mandando a distancia mínima
  // em seguida manda o número mínimo de minVizinhos
  // por fim envia o dado de comparação

  *REQUEST = 1;
  while(*ack == 0);
  *DATA_BASE = raio;
  *REQUEST = 0;
  while(*ack == 1);
  *REQUEST = 1;
  while(*ack == 0);
  *DATA_BASE = minVizinhos;
  *REQUEST = 0;
  while(*ack == 1);
  *REQUEST = 1;
  while(*ack == 0);
  *DATA_BASE = vector_aux;
  *REQUEST = 0;

  for(i = 0;i<QUANTIDADE_DE_DADOS;i ++){
    // testa se já não deu interrupt
    if(*INTERRUPT == 1){
      return 1;
    }

    // distancia euclidiana
    //x1
    vector_aux[3] = matriz[i][0];
    //x2
    vector_aux[2] = matriz[i+1][0];
    //y1
    vector_aux[1] = matriz[i][1];
    //y2 -> alem de pegar o proximo dado avança o i também
    vector_aux[0] = matriz[i++][1];

    // espera até ter livre
    while(*ack == 1);
      *REQUEST = 1;

    // esta livre envia os dados
    while(*ack == 0);
      *DATA_BASE = vector_aux;
      *REQUEST = 0;
  }

  return 0;
}

int main()
{
	quantos_vizinhos(1,1,5);

  return 0;
}
